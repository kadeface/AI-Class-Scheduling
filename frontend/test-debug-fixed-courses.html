<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›ºå®šæ—¶é—´è¯¾ç¨‹æ•°æ®è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .debug-button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; white-space: pre-wrap; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>ğŸ” å›ºå®šæ—¶é—´è¯¾ç¨‹æ•°æ®è°ƒè¯•</h1>
    
    <div class="debug-section">
        <h2>1. æ¨¡æ‹Ÿæ‚¨çœ‹åˆ°çš„æ•°æ®ç»“æ„</h2>
        <button class="debug-button" onclick="simulateYourData()">æ¨¡æ‹Ÿæ•°æ®ç»“æ„</button>
        <div id="simulateResult" class="result"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. æ£€æŸ¥æ•°ç»„å†…å®¹</h2>
        <button class="debug-button" onclick="checkArrayContent()">æ£€æŸ¥æ•°ç»„å†…å®¹</button>
        <div id="arrayResult" class="result"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. åœ¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†ä¿¡æ¯</h2>
        <button class="debug-button" onclick="logToConsole()">è¾“å‡ºåˆ°æ§åˆ¶å°</button>
        <div id="consoleResult" class="result"></div>
    </div>

    <script>
        let mockData = null;
        
        function simulateYourData() {
            // æ¨¡æ‹Ÿæ‚¨åœ¨æ§åˆ¶å°çœ‹åˆ°çš„æ•°æ®ç»“æ„
            mockData = {
                courseArrangementRules: {
                    allowContinuousCourses: false,
                    avoidFirstLastPeriod: [],
                    coreSubjectPriority: true,
                    coreSubjectStrategy: {
                        enableCoreSubjectStrategy: true, 
                        coreSubjects: ["è¯­æ–‡", "æ•°å­¦", "è‹±è¯­"], 
                        distributionMode: "daily", 
                        maxDailyOccurrences: 2, 
                        minDaysPerWeek: 5
                    },
                    defaultSubjectInterval: 1,
                    distributionPolicy: "balanced",
                    enableSubjectConstraints: true,
                    fixedTimeCourses: {
                        enabled: true, 
                        courses: [
                            {
                                type: 'class-meeting',
                                dayOfWeek: 1,
                                period: 1,
                                weekType: 'all',
                                startWeek: 1,
                                endWeek: 20,
                                notes: 'ç­ä¸»ä»»ä¸»æŒç­ä¼š'
                            }
                        ], 
                        priority: true, 
                        allowOverride: false, 
                        conflictStrategy: "strict"
                    },
                    labCoursePreference: "afternoon",
                    maxContinuousHours: 2,
                    subjectSpecificRules: []
                }
            };
            
            let resultHtml = '<div class="success">âœ… æ•°æ®ç»“æ„æ¨¡æ‹Ÿå®Œæˆ</div>';
            resultHtml += '<div class="warning">âš ï¸ æ³¨æ„ï¼šåœ¨æ§åˆ¶å°ä¸­ï¼Œcourseså­—æ®µå¯èƒ½æ˜¾ç¤ºä¸º "Array" è€Œä¸æ˜¯å…·ä½“å†…å®¹</div>';
            resultHtml += '<strong>æ•°æ®ç»“æ„:</strong><br>';
            resultHtml += '<pre>' + JSON.stringify(mockData, null, 2) + '</pre>';
            
            document.getElementById('simulateResult').innerHTML = resultHtml;
        }
        
        function checkArrayContent() {
            if (!mockData) {
                document.getElementById('arrayResult').innerHTML = '<div class="error">âŒ è¯·å…ˆæ¨¡æ‹Ÿæ•°æ®ç»“æ„</div>';
                return;
            }
            
            const ftc = mockData.courseArrangementRules.fixedTimeCourses;
            const courses = ftc.courses;
            
            let resultHtml = '<div class="success">âœ… æ•°ç»„å†…å®¹æ£€æŸ¥å®Œæˆ</div>';
            resultHtml += '<strong>fixedTimeCourses è¯¦æƒ…:</strong><br>';
            resultHtml += 'enabled: ' + ftc.enabled + '<br>';
            resultHtml += 'priority: ' + ftc.priority + '<br>';
            resultHtml += 'allowOverride: ' + ftc.allowOverride + '<br>';
            resultHtml += 'conflictStrategy: ' + ftc.conflictStrategy + '<br>';
            resultHtml += '<br>';
            
            resultHtml += '<strong>courses æ•°ç»„è¯¦æƒ…:</strong><br>';
            resultHtml += 'ç±»å‹: ' + typeof courses + '<br>';
            resultHtml += 'æ˜¯å¦ä¸ºæ•°ç»„: ' + Array.isArray(courses) + '<br>';
            resultHtml += 'é•¿åº¦: ' + courses.length + '<br>';
            resultHtml += '<br>';
            
            resultHtml += '<strong>è¯¾ç¨‹åˆ—è¡¨:</strong><br>';
            courses.forEach((course, index) => {
                resultHtml += `è¯¾ç¨‹ ${index + 1}:<br>`;
                resultHtml += `  ç±»å‹: ${course.type}<br>`;
                resultHtml += `  æ˜ŸæœŸ: å‘¨${course.dayOfWeek}<br>`;
                resultHtml += `  èŠ‚æ¬¡: ç¬¬${course.period}èŠ‚<br>`;
                resultHtml += `  å‘¨æ¬¡ç±»å‹: ${course.weekType}<br>`;
                resultHtml += `  å¼€å§‹å‘¨æ¬¡: ${course.startWeek}<br>`;
                resultHtml += `  ç»“æŸå‘¨æ¬¡: ${course.endWeek}<br>`;
                if (course.notes) {
                    resultHtml += `  å¤‡æ³¨: ${course.notes}<br>`;
                }
                resultHtml += '<br>';
            });
            
            document.getElementById('arrayResult').innerHTML = resultHtml;
        }
        
        function logToConsole() {
            if (!mockData) {
                document.getElementById('consoleResult').innerHTML = '<div class="error">âŒ è¯·å…ˆæ¨¡æ‹Ÿæ•°æ®ç»“æ„</div>';
                return;
            }
            
            console.log('ğŸ” å›ºå®šæ—¶é—´è¯¾ç¨‹è¯¦ç»†è°ƒè¯•ä¿¡æ¯ ====================');
            
            const ftc = mockData.courseArrangementRules.fixedTimeCourses;
            console.log('å®Œæ•´çš„ fixedTimeCourses å¯¹è±¡:', ftc);
            
            console.log('courses å­—æ®µç±»å‹:', typeof ftc.courses);
            console.log('courses æ˜¯å¦ä¸ºæ•°ç»„:', Array.isArray(ftc.courses));
            console.log('courses é•¿åº¦:', ftc.courses.length);
            
            console.log('courses æ•°ç»„å†…å®¹:');
            ftc.courses.forEach((course, index) => {
                console.log(`  è¯¾ç¨‹ ${index + 1}:`, course);
                console.log(`    ç±»å‹: ${course.type}`);
                console.log(`    æ˜ŸæœŸ: å‘¨${course.dayOfWeek}`);
                console.log(`    èŠ‚æ¬¡: ç¬¬${course.period}èŠ‚`);
                console.log(`    å‘¨æ¬¡ç±»å‹: ${course.weekType}`);
                console.log(`    å¼€å§‹å‘¨æ¬¡: ${course.startWeek}`);
                console.log(`    ç»“æŸå‘¨æ¬¡: ${course.endWeek}`);
                if (course.notes) {
                    console.log(`    å¤‡æ³¨: ${course.notes}`);
                }
            });
            
            // æ£€æŸ¥JSONåºåˆ—åŒ–
            console.log('JSONåºåˆ—åŒ–æµ‹è¯•:');
            const jsonString = JSON.stringify(ftc);
            console.log('JSONå­—ç¬¦ä¸²:', jsonString);
            console.log('JSONå­—ç¬¦ä¸²é•¿åº¦:', jsonString.length);
            
            // æ£€æŸ¥è½¬ä¹‰å­—ç¬¦
            const escapeCount = (jsonString.match(/\\/g) || []).length;
            console.log('è½¬ä¹‰å­—ç¬¦æ•°é‡:', escapeCount);
            
            if (escapeCount > 0) {
                console.warn('âš ï¸ å‘ç°è½¬ä¹‰å­—ç¬¦ï¼Œå¯èƒ½å­˜åœ¨åºåˆ—åŒ–é—®é¢˜');
                console.log('è½¬ä¹‰å­—ç¬¦ä½ç½®:', [...jsonString.matchAll(/\\/g)].map(m => m.index));
            }
            
            console.log('ğŸ” è°ƒè¯•ä¿¡æ¯ç»“æŸ ====================');
            
            document.getElementById('consoleResult').innerHTML = '<div class="success">âœ… è¯¦ç»†ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·</div>';
        }
    </script>
</body>
</html>
