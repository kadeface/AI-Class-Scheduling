<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>固定时间课程数据调试</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .debug-button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; white-space: pre-wrap; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>🔍 固定时间课程数据调试</h1>
    
    <div class="debug-section">
        <h2>1. 模拟您看到的数据结构</h2>
        <button class="debug-button" onclick="simulateYourData()">模拟数据结构</button>
        <div id="simulateResult" class="result"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. 检查数组内容</h2>
        <button class="debug-button" onclick="checkArrayContent()">检查数组内容</button>
        <div id="arrayResult" class="result"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. 在控制台输出详细信息</h2>
        <button class="debug-button" onclick="logToConsole()">输出到控制台</button>
        <div id="consoleResult" class="result"></div>
    </div>

    <script>
        let mockData = null;
        
        function simulateYourData() {
            // 模拟您在控制台看到的数据结构
            mockData = {
                courseArrangementRules: {
                    allowContinuousCourses: false,
                    avoidFirstLastPeriod: [],
                    coreSubjectPriority: true,
                    coreSubjectStrategy: {
                        enableCoreSubjectStrategy: true, 
                        coreSubjects: ["语文", "数学", "英语"], 
                        distributionMode: "daily", 
                        maxDailyOccurrences: 2, 
                        minDaysPerWeek: 5
                    },
                    defaultSubjectInterval: 1,
                    distributionPolicy: "balanced",
                    enableSubjectConstraints: true,
                    fixedTimeCourses: {
                        enabled: true, 
                        courses: [
                            {
                                type: 'class-meeting',
                                dayOfWeek: 1,
                                period: 1,
                                weekType: 'all',
                                startWeek: 1,
                                endWeek: 20,
                                notes: '班主任主持班会'
                            }
                        ], 
                        priority: true, 
                        allowOverride: false, 
                        conflictStrategy: "strict"
                    },
                    labCoursePreference: "afternoon",
                    maxContinuousHours: 2,
                    subjectSpecificRules: []
                }
            };
            
            let resultHtml = '<div class="success">✅ 数据结构模拟完成</div>';
            resultHtml += '<div class="warning">⚠️ 注意：在控制台中，courses字段可能显示为 "Array" 而不是具体内容</div>';
            resultHtml += '<strong>数据结构:</strong><br>';
            resultHtml += '<pre>' + JSON.stringify(mockData, null, 2) + '</pre>';
            
            document.getElementById('simulateResult').innerHTML = resultHtml;
        }
        
        function checkArrayContent() {
            if (!mockData) {
                document.getElementById('arrayResult').innerHTML = '<div class="error">❌ 请先模拟数据结构</div>';
                return;
            }
            
            const ftc = mockData.courseArrangementRules.fixedTimeCourses;
            const courses = ftc.courses;
            
            let resultHtml = '<div class="success">✅ 数组内容检查完成</div>';
            resultHtml += '<strong>fixedTimeCourses 详情:</strong><br>';
            resultHtml += 'enabled: ' + ftc.enabled + '<br>';
            resultHtml += 'priority: ' + ftc.priority + '<br>';
            resultHtml += 'allowOverride: ' + ftc.allowOverride + '<br>';
            resultHtml += 'conflictStrategy: ' + ftc.conflictStrategy + '<br>';
            resultHtml += '<br>';
            
            resultHtml += '<strong>courses 数组详情:</strong><br>';
            resultHtml += '类型: ' + typeof courses + '<br>';
            resultHtml += '是否为数组: ' + Array.isArray(courses) + '<br>';
            resultHtml += '长度: ' + courses.length + '<br>';
            resultHtml += '<br>';
            
            resultHtml += '<strong>课程列表:</strong><br>';
            courses.forEach((course, index) => {
                resultHtml += `课程 ${index + 1}:<br>`;
                resultHtml += `  类型: ${course.type}<br>`;
                resultHtml += `  星期: 周${course.dayOfWeek}<br>`;
                resultHtml += `  节次: 第${course.period}节<br>`;
                resultHtml += `  周次类型: ${course.weekType}<br>`;
                resultHtml += `  开始周次: ${course.startWeek}<br>`;
                resultHtml += `  结束周次: ${course.endWeek}<br>`;
                if (course.notes) {
                    resultHtml += `  备注: ${course.notes}<br>`;
                }
                resultHtml += '<br>';
            });
            
            document.getElementById('arrayResult').innerHTML = resultHtml;
        }
        
        function logToConsole() {
            if (!mockData) {
                document.getElementById('consoleResult').innerHTML = '<div class="error">❌ 请先模拟数据结构</div>';
                return;
            }
            
            console.log('🔍 固定时间课程详细调试信息 ====================');
            
            const ftc = mockData.courseArrangementRules.fixedTimeCourses;
            console.log('完整的 fixedTimeCourses 对象:', ftc);
            
            console.log('courses 字段类型:', typeof ftc.courses);
            console.log('courses 是否为数组:', Array.isArray(ftc.courses));
            console.log('courses 长度:', ftc.courses.length);
            
            console.log('courses 数组内容:');
            ftc.courses.forEach((course, index) => {
                console.log(`  课程 ${index + 1}:`, course);
                console.log(`    类型: ${course.type}`);
                console.log(`    星期: 周${course.dayOfWeek}`);
                console.log(`    节次: 第${course.period}节`);
                console.log(`    周次类型: ${course.weekType}`);
                console.log(`    开始周次: ${course.startWeek}`);
                console.log(`    结束周次: ${course.endWeek}`);
                if (course.notes) {
                    console.log(`    备注: ${course.notes}`);
                }
            });
            
            // 检查JSON序列化
            console.log('JSON序列化测试:');
            const jsonString = JSON.stringify(ftc);
            console.log('JSON字符串:', jsonString);
            console.log('JSON字符串长度:', jsonString.length);
            
            // 检查转义字符
            const escapeCount = (jsonString.match(/\\/g) || []).length;
            console.log('转义字符数量:', escapeCount);
            
            if (escapeCount > 0) {
                console.warn('⚠️ 发现转义字符，可能存在序列化问题');
                console.log('转义字符位置:', [...jsonString.matchAll(/\\/g)].map(m => m.index));
            }
            
            console.log('🔍 调试信息结束 ====================');
            
            document.getElementById('consoleResult').innerHTML = '<div class="success">✅ 详细信息已输出到控制台，请查看浏览器开发者工具</div>';
        }
    </script>
</body>
</html>
